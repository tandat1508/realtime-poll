(this["webpackJsonphasura-realtime-poll"]=this["webpackJsonphasura-realtime-poll"]||[]).push([[0],{66:function(e,t,n){e.exports=n.p+"static/media/logo-white.c3351f89.svg"},77:function(e,t,n){e.exports=n(89)},82:function(e,t,n){},85:function(e,t,n){},89:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),l=n(42),o=n.n(l),c=(n(82),n(25)),u=n.n(c),i=n(34),s=n(38),d=n(102),m=n(47),p=n(71),v=n(104),f=n(106),E=n(64),b=Object(E.a)((function(e,t){var n=t.headers;return{headers:Object(m.a)({},n,{"x-hasura-admin-secret":"0j3O8G4L107Q7jB3vIpjdfaFfMAsn1Pq4vPqjCor0WQVDUuEn1CN7Jz3LF3NvJiT"})}})),h=Object(p.a)({uri:"https://poll-app-react.hasura.app/v1/graphql"}),g=new v.a({link:b.concat(h),cache:new f.a}),y=(n(85),n(66)),j=n.n(y),O=function(){return r.a.createElement("div",null,"Loading...")},_=function(e){var t=e.message;return r.a.createElement("div",{className:"alert alert-danger",role:"alert"},r.a.createElement("b",null,"Error:")," ",t)},x=function(){return r.a.createElement("header",{className:"App-header displayFlex"},r.a.createElement("div",{className:"container displayFlex"},r.a.createElement("img",{src:j.a,className:"App-logo",alt:"logo"}),r.a.createElement("h1",{className:"App-title"},"Realtime Poll")))},N=function(){return r.a.createElement("footer",{className:"App-footer displayFlex"},r.a.createElement("div",{className:"container hasura-logo"},r.a.createElement("a",{href:"https://hasura.io",target:"_blank",rel:"noopener noreferrer"},r.a.createElement("img",{className:"hasura-logo",alt:"hasura logo",src:"https://graphql-engine-cdn.hasura.io/img/powered_by_hasura_black_200px.png"})),"\xa0 | \xa0",r.a.createElement("a",{href:"https://realtime-poll.hasura.app/console",target:"_blank",rel:"noopener noreferrer"},"Backend"),"\xa0 | \xa0",r.a.createElement("a",{href:"https://github.com/hasura/graphql-engine/tree/master/community/sample-apps/realtime-poll",target:"_blank",rel:"noopener noreferrer"},"Source"),r.a.createElement("div",{className:"footer-small-text"},r.a.createElement("span",null,"(The database resets every 24 hours)"))))},I=n(29),w=n(30),B=n(107);function k(){var e=Object(I.a)(["\n  mutation newUser($uuid: uuid) {\n    insert_user(objects: [{ id: $uuid }]) {\n      returning {\n        id\n        created_at\n      }\n    }\n  }\n"]);return k=function(){return e},e}function S(){var e=Object(I.a)(["\n  mutation userOnline($uuid: uuid) {\n    update_user(where: { id: { _eq: $uuid } }, _set: { online_ping: true }) {\n      affected_rows\n      returning {\n        last_seen_at\n      }\n    }\n  }\n"]);return S=function(){return e},e}function T(){var e=Object(I.a)(["\n  subscription getOnlineUsersCount {\n    online_user {\n      count\n    }\n  }\n"]);return T=function(){return e},e}function q(){var e=Object(I.a)(["\n  subscription getResult($pollId: uuid!) {\n    poll_results(\n      order_by: { option_id: desc }\n      where: { poll_id: { _eq: $pollId } }\n    ) {\n      option_id\n      option {\n        id\n        text\n      }\n      votes\n    }\n  }\n"]);return q=function(){return e},e}function C(){var e=Object(I.a)(["\n  mutation vote($optionId: uuid!, $userId: uuid!) {\n    insert_vote(\n      objects: [{ option_id: $optionId, created_by_user_id: $userId }]\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return C=function(){return e},e}function $(){var e=Object(I.a)(["\n  query {\n    poll(limit: 10) {\n      id\n      question\n      options(order_by: { id: desc }) {\n        id\n        text\n      }\n    }\n  }\n"]);return $=function(){return e},e}var F=Object(w.a)($()),L=Object(w.a)(C()),A=Object(w.a)(q()),G=Object(w.a)(T()),Q=Object(w.a)(S()),J=Object(w.a)(k()),M=function(){return r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"col-md-12 cardGraphQL"},r.a.createElement(B.a,null,r.a.createElement(B.a.Header,null,"GraphQL Queries/Mutations/Subscriptions in this page"),r.a.createElement(B.a.Body,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-4"},"Get the Poll question and options:",r.a.createElement("pre",null,F.loc.source.body),"Create a new user:",r.a.createElement("pre",null,J.loc.source.body)),r.a.createElement("div",{className:"col-md-4"},"Cast a vote:",r.a.createElement("pre",null,L.loc.source.body),"Mark user online:",r.a.createElement("pre",null,Q.loc.source.body)),r.a.createElement("div",{className:"col-md-4"},"Show live results:",r.a.createElement("pre",null,A.loc.source.body),"Get real-time number of users:",r.a.createElement("pre",null,G.loc.source.body)))))))},P=n(100),D=n(109),R=n(103),U=n(101),V=n(99),W=n(68),z=function(e){var t=e.pollId,n=Object(V.a)(A,{variables:{pollId:t}}),a=n.data,l=n.loading,o=n.error,c=(null===a||void 0===a?void 0:a.poll_results.length)>0;return l?r.a.createElement(O,null):o?r.a.createElement(_,{message:o.message}):r.a.createElement("div",null,c?r.a.createElement(H,{data:null===a||void 0===a?void 0:a.poll_results}):r.a.createElement("p",null,"No result"))},H=function(e){var t=e.data,n=[["Option","No. of votes",{role:"annotation"},{role:"style"}]];return t.forEach((function(e){var t=e.option,a=e.votes;return n.push([t.text,parseInt(a),parseInt(a),"color: #4285f4"])})),r.a.createElement(W.a,{className:"poll-result-chart-container",chartType:"BarChart",loader:r.a.createElement("div",null,"Loading Chart"),data:n,options:K})},K={height:"100%",chart:{title:"Realtime results"},legend:{position:"none"},animation:{duration:1e3,easing:"out",startup:!0}},X=function(e){var t=e.poll,n=e.userId,l={optionId:"",pollId:t.id,voteBtnText:"\ud83d\uddf3 Vote",voteBtnStyle:"primary"},o=Object(a.useState)(l),c=Object(s.a)(o,2),u=c[0],i=c[1],d=Object(P.a)(L),p=Object(s.a)(d,2),v=p[0],f=p[1],E=f.data,b=f.error;Object(a.useEffect)((function(){if(E){i({voteBtnText:"\ud83d\udc4d Done",voteBtnStyle:"success"});var e=setTimeout((function(){i({voteBtnText:"\ud83d\uddf3\ufe0f Vote",voteBtnStyle:"primary"})}),5e3);return function(){return clearTimeout(e)}}b&&i({voteBtnText:"Error \ud83d\ude1e Try again",voteBtnStyle:"danger"})}),[E,b]);var h=function(e){var t=e.currentTarget.value;i((function(e){return Object(m.a)({},e,{optionId:t})}))};return r.a.createElement("div",{className:"textLeft"},r.a.createElement("h3",null,t.question),r.a.createElement(R.a,{className:"pollForm textLeft",onSubmit:function(e){!function(e){e.preventDefault(),u.optionId?(i({voteBtnText:"\ud83d\uddf3\ufe0f Submitting",voteBtnStyle:"info"}),v({variables:{optionId:u.optionId,userId:n}})):i({voteBtnText:"\u270b Select an option and try again",voteBtnStyle:"warning"})}(e)}},t.options.map((function(e){var t=e.id,n=e.text;return r.a.createElement(R.a.Check,{custom:!0,type:"radio",name:"voteCandidate",id:t,key:t,value:t,label:n,onChange:h})})),r.a.createElement(U.a,{className:"voteBtn info",variant:u.voteBtnStyle,type:"submit"},u.voteBtnText)))},Y=function(e){var t=e.userId,n=Object(D.a)(F),a=n.data,l=n.loading,o=n.error;return l?r.a.createElement(O,null):o?r.a.createElement(_,{message:o.message}):r.a.createElement("div",{className:"container"},null===a||void 0===a?void 0:a.poll.map((function(e){return r.a.createElement("div",{key:e.id,className:"pollWrapper wd100"},r.a.createElement("div",{className:"displayFlex"},r.a.createElement("div",{className:"col-md-4 pollSlider"},r.a.createElement(X,{poll:e,userId:t})),r.a.createElement("div",{className:"col-md-8 pollresult"},r.a.createElement(z,{pollId:e.id}))))})))},Z=function(){var e=function(e){var t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t};return e()+e(!0)+e(!0)+e()},ee=function(){var e=Object(i.a)(u.a.mark((function e(){var t,n,a,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.mutate({mutation:J,variables:{uuid:Z()}});case 2:if(t=e.sent,n=t.data,e.prev=4,!((null===n||void 0===n?void 0:n.insert_user.returning.length)>0)){e.next=11;break}return a=n.insert_user.returning[0]||{},r=a.id,te(r),e.abrupt("return",r);case 11:throw new Error(400);case 12:e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(4),console.error(e.t0),new Error(400);case 18:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(){return e.apply(this,arguments)}}(),te=function(e){window.setInterval(Object(i.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,g.mutate({mutation:Q,variables:{uuid:e}});case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),console.error(t.t0);case 8:case"end":return t.stop()}}),t,null,[[0,5]])}))),1e4)},ne=n(105),ae=function(){var e=Object(V.a)(G),t=e.data,n=e.loading,a=e.error,l=((null===t||void 0===t?void 0:t.online_user[0])||{}).count;return n?r.a.createElement(O,null):a?r.a.createElement(_,{message:a.message}):r.a.createElement("div",{className:"displayFlex online-users"},r.a.createElement("div",{className:"col-md-6"},r.a.createElement(ne.a,{variant:"info"},r.a.createElement("span",{role:"img","aria-label":"online users"},"\ud83d\udc65")," ","Online users: ",l)))},re=function(){var e=Object(a.useState)({loading:!0,userId:""}),t=Object(s.a)(e,2),n=t[0],l=t[1];return Object(a.useEffect)((function(){(function(){var e=Object(i.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee();case 2:t=e.sent,l({loading:!1,userId:t});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),r.a.createElement(d.a,{client:g},r.a.createElement("div",{className:"App"},r.a.createElement(x,null),r.a.createElement(ae,null),r.a.createElement(Y,{userId:n.userId}),r.a.createElement(M,null),r.a.createElement(N,null)))};o.a.render(r.a.createElement(re,null),document.getElementById("root"))}},[[77,1,2]]]);
//# sourceMappingURL=main.d5311ba2.chunk.js.map